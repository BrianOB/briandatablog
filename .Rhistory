unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
jenkies2,
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Churches per 10 square miles by state") +
theme(legend.position = 'right') +
scale_fill_discrete(name='Density')
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
jenkies2,
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Church Concentrations by state") +
theme(legend.position = 'right',
plot.title=element_text(hjust=.5)) +
scale_fill_discrete(name='Density')
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
jenkies2,
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Church Concentrations by state") +
theme(legend.position = 'right',
plot.title=element_text(hjust=.5, size=24)) +
scale_fill_discrete(name='Density')
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
jenkies2,
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Church Concentrations by state") +
theme(legend.position = 'right',
plot.title=element_text(hjust=.5, size=24)) +
scale_fill_discrete(name='Churches per 10 square miles')
colors()
palette()
rgb()
heat.colors()
heat.colors(5)
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
jenkies2,
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Church Concentrations by state") +
theme(legend.position = 'right',
plot.title=element_text(hjust=.5, size=24)) +
scale_fill_discrete(name='Churches per 10 square miles',
palette(heat.colors(5)))
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
jenkies2,
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Church Concentrations by state") +
theme(legend.position = 'right',
plot.title=element_text(hjust=.5, size=24)) +
scale_fill_discrete(name='Churches per 10 square miles')
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
jenkies2,
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Church Concentrations by state") +
theme(legend.position = 'right',
plot.title=element_text(hjust=.5, size=24)) +
scale_fill_discrete(name='Churches per 10 square miles',
palette('viridis'))
library(viridis)
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
jenkies2,
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Church Concentrations by state") +
theme(legend.position = 'right',
plot.title=element_text(hjust=.5, size=24)) +
scale_fill_discrete(name='Churches per 10 square miles',
palette('viridis'))
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
jenkies2,
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Church Concentrations by state") +
theme(legend.position = 'right',
plot.title=element_text(hjust=.5, size=24)) +
scale_fill_viridis(name='Churches per 10 square miles')
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
jenkies2,
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Church Concentrations by state") +
theme(legend.position = 'right',
plot.title=element_text(hjust=.5, size=24)) +
scale_fill_viridis(name='Churches per 10 square miles',discrete=T)
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
jenkies2,
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Church Concentrations by state") +
theme(legend.position = 'right',
plot.title=element_text(hjust=.5, size=24)) +
scale_fill_viridis(name='Churches per 10 square miles',discrete=T,direction=-1)
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
breaks=c(.5, 1, 2, 3, 102),
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
breaks=c(0,.5, 1, 2, 3, 102),
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Church Concentrations by state") +
theme(legend.position = 'right',
plot.title=element_text(hjust=.5, size=24)) +
scale_fill_viridis(name='Churches per 10 square miles',discrete=T,direction=-1)
pa_density <- churches_per_state$churches_10sq_mi[churches_per_state$state="pennsylvania"]
pa_density <- churches_per_state$churches_10sq_mi[churches_per_state$state=="pennsylvania"]
pa_density <- churches_per_state$churches_10sq_mi[churches_per_state$state=="Pennsylvania"]
wv_density <- churches_per_state$churches_10sq_mi[churches_per_state$state=="West Virginia"]
pa_density <- round(churches_per_state$churches_10sq_mi[churches_per_state$state=="Pennsylvania"],digits=1)
wv_density <- round(churches_per_state$churches_10sq_mi[churches_per_state$state=="West Virginia"],digits=1)
churches_per_state %>%
select(State = state, Density = churches_10sq_mi) %>%
datatable()
churches_per_state %>%
mutate(churches_10sq_mi = round(churches_10sq_mi,digits=1)) %>%
select(State = state, Density = churches_10sq_mi) %>%
datatable()
churches_per_state %>%
mutate(churches_10sq_mi = round(churches_10sq_mi,digits=1)) %>%
select(State = state, Churches=Number, Density = churches_10sq_mi) %>%
datatable() %>%
formatCurrency('Churches',currency='',digits=0)
46054 / 24230
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::new_post_addin()
(us_cases | us_deaths) / (world_cases | world_deaths) + plot_annotation(title='Coronavirus trends',
subtitle='New cases and deaths reported daily')
data_raw_path <- 'D:/Documents/projects/data_workshop/data_raw/'
# get last download date-time
load(paste0(data_raw_path,'dl.RData'))
ecdpc_url <- "https://opendata.ecdc.europa.eu/covid19/casedistribution/csv"
current_dt <- now('UTC')
library(tidyverse)
library(lubridate)
library(patchwork)
data_raw_path <- 'D:/Documents/projects/data_workshop/data_raw/'
# get last download date-time
load(paste0(data_raw_path,'dl.RData'))
ecdpc_url <- "https://opendata.ecdc.europa.eu/covid19/casedistribution/csv"
current_dt <- now('UTC')
if (as.numeric(current_dt - dl_dt,unit='days') > 1) {
# been more than 24 hours since last download, so get new data
download.file(ecdpc_url,paste0(data_raw_path,'casedistribution.csv'))
# save current as new download date-time
dl_dt <- current_dt
save(dl_dt,file=paste0(data_raw_path,'dl.RData'))
}
ecdpc_data <- read_csv(paste0(data_raw_path,'casedistribution.csv'))
# convert dateRep to date
ecdpc_data <- ecdpc_data %>%
mutate(dateRep=as.Date(dateRep,'%d/%m/%Y'))
us_cases <- ecdpc_data %>%
filter(geoId == 'US') %>%
arrange(dateRep) %>%
ggplot(aes(x=dateRep)) +
geom_col(aes(y=cases)) +
labs(title='US cases',x='',y='') +
scale_y_continuous(label=scales::comma)
us_deaths <- ecdpc_data %>%
filter(geoId == 'US') %>%
arrange(dateRep) %>%
ggplot(aes(x=dateRep)) +
geom_col(aes(y=deaths)) +
labs(title='US deaths',x='',y='') +
scale_y_continuous(label=scales::comma)
world_cases <- ecdpc_data %>%
group_by(dateRep) %>%
summarise(cases = sum(cases)) %>%
arrange(dateRep) %>%
ggplot(aes(x=dateRep)) +
geom_col(aes(y=cases)) +
labs(title='World cases',x='',y='') +
scale_y_continuous(label=scales::comma)
world_deaths <- ecdpc_data %>%
group_by(dateRep) %>%
summarise(deaths = sum(deaths)) %>%
arrange(dateRep) %>%
ggplot(aes(x=dateRep)) +
geom_col(aes(y=deaths)) +
labs(title='World deaths',x='',y='') +
scale_y_continuous(label=scales::comma)
china_cases <- ecdpc_data %>%
filter(geoId == 'CN') %>%
arrange(dateRep) %>%
ggplot(aes(x=dateRep)) +
geom_col(aes(y=cases)) +
labs(title='China cases',x='',y='') +
scale_y_continuous(label=scales::comma)
china_deaths <- ecdpc_data %>%
filter(geoId == 'CN') %>%
arrange(dateRep) %>%
ggplot(aes(x=dateRep)) +
geom_col(aes(y=deaths)) +
labs(title='China deaths',x='',y='') +
scale_y_continuous(label=scales::comma)
italy_cases <- ecdpc_data %>%
filter(geoId == 'IT') %>%
arrange(dateRep) %>%
ggplot(aes(x=dateRep)) +
geom_col(aes(y=cases)) +
labs(title='Italy cases',x='',y='') +
scale_y_continuous(label=scales::comma)
italy_deaths <- ecdpc_data %>%
filter(geoId == 'IT') %>%
arrange(dateRep) %>%
ggplot(aes(x=dateRep)) +
geom_col(aes(y=deaths)) +
labs(title='Italy deaths',x='',y='') +
scale_y_continuous(label=scales::comma)
(us_cases | us_deaths) / (world_cases | world_deaths) + plot_annotation(title='Coronavirus trends',
subtitle='New cases and deaths reported daily')
china_cases | china_deaths
italy_cases | italy_deaths
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
library(tidyverse)
library(lubridate)
library(patchwork)
data_raw_path <- 'data_raw/'
# get last download date-time
load(paste0(data_raw_path,'dl.RData'))
ecdpc_url <- "https://opendata.ecdc.europa.eu/covid19/casedistribution/csv"
current_dt <- now('UTC')
if (as.numeric(current_dt - dl_dt,unit='days') > 1) {
# been more than 24 hours since last download, so get new data
download.file(ecdpc_url,paste0(data_raw_path,'casedistribution.csv'))
# save current as new download date-time
dl_dt <- current_dt
save(dl_dt,file=paste0(data_raw_path,'dl.RData'))
}
ecdpc_data <- read_csv(paste0(data_raw_path,'casedistribution.csv'))
# convert dateRep to date
ecdpc_data <- ecdpc_data %>%
mutate(dateRep=as.Date(dateRep,'%d/%m/%Y'))
survival <- ecdpc_data %>%
group_by(countriesAndTerritories) %>%
summarise(cases_total = sum(cases),
deaths_total = sum(deaths)) %>%
filter(cases_total >= 100) %>%
mutate(death_rate = round(deaths_total/cases_total,digits=3))
survival %>%
filter(death_rate > 0) %>%
summarise(best = min(death_rate),
worst = max(death_rate),
median = median(death_rate))
survival %>%
filter(death_rate > 0) %>%
arrange(death_rate) %>%
ggplot(aes(x=death_rate)) +
geom_histogram(breaks = seq(0,.14,.01)) +
labs(title='Deaths per cases',
y='Number of countries',
x= 'Deaths as percentage of cases') +
scale_x_continuous(labels=scales::percent,
breaks = c(0.001, .0265, .132))
us_cases <- ecdpc_data %>%
filter(geoId == 'US') %>%
arrange(dateRep) %>%
ggplot(aes(x=dateRep)) +
geom_col(aes(y=cases)) +
labs(title='US cases',x='',y='') +
scale_y_continuous(label=scales::comma)
us_deaths <- ecdpc_data %>%
filter(geoId == 'US') %>%
arrange(dateRep) %>%
ggplot(aes(x=dateRep)) +
geom_col(aes(y=deaths)) +
labs(title='US deaths',x='',y='') +
scale_y_continuous(label=scales::comma)
world_cases <- ecdpc_data %>%
group_by(dateRep) %>%
summarise(cases = sum(cases)) %>%
arrange(dateRep) %>%
ggplot(aes(x=dateRep)) +
geom_col(aes(y=cases)) +
labs(title='World cases',x='',y='') +
scale_y_continuous(label=scales::comma)
world_deaths <- ecdpc_data %>%
group_by(dateRep) %>%
summarise(deaths = sum(deaths)) %>%
arrange(dateRep) %>%
ggplot(aes(x=dateRep)) +
geom_col(aes(y=deaths)) +
labs(title='World deaths',x='',y='') +
scale_y_continuous(label=scales::comma)
(us_cases | us_deaths) / (world_cases | world_deaths) + plot_annotation(title='Coronavirus trends',
subtitle='New cases and deaths reported daily')
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::new_post_addin()
library(tidyverse)
library(rvest)
library(lubridate)
url_cdc_testing_data <- 'https://www.cdc.gov/coronavirus/2019-ncov/cases-updates/testing-in-us.html'
cdc_testing_web <- read_html(url_cdc_testing_data)
endnote <- function(x) {
return(str_detect(x,'\\d$',negate=T))
}
get_last <- function(x) {
return(substr(x, nchar(x), nchar(x)))
}
cutnote <- function(x) {
return(substr(x, 1, nchar(x)-1))
}
cdc_test_data <- html_nodes(cdc_testing_web, 'table') %>%
html_nodes('td') %>%
html_text() %>%
matrix(ncol=3, byrow=T, dimnames=list(NULL,c('date','CDC_labs','public_health_labs'))) %>%
as_tibble() %>%
pivot_longer(cols=c(CDC_labs, public_health_labs), names_to='lab_type',
values_to = 'tests') %>%
mutate(date = mdy(paste0(date,'/2020')),
note = ifelse(endnote(tests),get_last(tests),''),
tests = as.integer(ifelse(endnote(tests),cutnote(tests),tests)))
save(cdc_test_data, file='D:/Documents/projects/data_workshop/data_processed/cdc_test_data.RData)
save(cdc_test_data, file='D:/Documents/projects/data_workshop/data_processed/cdc_test_data.RData')
library(tidyverse)
# load data
load(file='D:/Documents/projects/data_workshop/data_processed/cdc_test_data.RData')
full_data_date <- cdc_test_data %>%
filter(lab_type=='public_health_labs', nchar(note) == 0) %>%
summarise(max_date = max(date)) %>%
pull(max_date)
cdc_test_data %>%
filter(date <= full_data_date) %>%
group_by(date) %>%
summarise(tests=sum(tests)) %>%
ggplot(aes(x=date, y=tests, group=1)) +
geom_line() +
scale_x_date() +
scale_y_continuous(labels=scales::comma) +
labs(title='Covid-19 testing in the United States',
x='',
y='Number of tests reported',
caption= 'Source:CDC\nNote: Data for last 7 days not shown because CDC says it\'s incomplete.\nThe periodic drops occur on weekends.')
library(DT)
cdc_test_data %>%
datatable()
cdc_test_data %>%
select(date, lab_type, tests) %>%
datatable()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::serve_site()
blogdown:::new_post_addin()
# libraries
library(tidyverse)
library(rvest)
library(lubridate)
# read the web page
url_cdc_testing_data <- 'https://www.cdc.gov/coronavirus/2019-ncov/cases-updates/testing-in-us.html'
cdc_testing_web <- read_html(url_cdc_testing_data)
# functions to process data
endnote <- function(x) {
return(str_detect(x,'\\d$',negate=T))
}
get_last <- function(x) {
return(substr(x, nchar(x), nchar(x)))
}
cutnote <- function(x) {
return(substr(x, 1, nchar(x)-1))
}
# get data from web page
cdc_test_data <- html_nodes(cdc_testing_web, 'table') %>%
html_nodes('td') %>%
html_text() %>%
matrix(ncol=3, byrow=T, dimnames=list(NULL,c('date','CDC_labs','public_health_labs'))) %>%
as_tibble() %>%
pivot_longer(cols=c(CDC_labs, public_health_labs), names_to='lab_type',
values_to = 'tests') %>%
mutate(date = mdy(paste0(date,'/2020')),
note = ifelse(endnote(tests),get_last(tests),''),
tests = as.integer(ifelse(endnote(tests),cutnote(tests),tests)))
# graph data
# get last date with complete data
full_data_date <- cdc_test_data %>%
filter(lab_type=='public_health_labs', nchar(note) == 0) %>%
summarise(max_date = max(date)) %>%
pull(max_date)
# draw line chart
cdc_test_data %>%
filter(date <= full_data_date) %>%
group_by(date) %>%
summarise(tests=sum(tests)) %>%
ggplot(aes(x=date, y=tests, group=1)) +
geom_line() +
scale_x_date() +
scale_y_continuous(labels=scales::comma) +
labs(title='Covid-19 testing in the United States',
x='',
y='Number of tests reported',
caption= 'Source:CDC\nNote: Data for last 7 days not shown because CDC says it\'s incomplete.\nThe periodic drops occur on weekends.')
# libraries
library(tidyverse)
library(rvest)
library(lubridate)
# read the web page
url_cdc_testing_data <- 'https://www.cdc.gov/coronavirus/2019-ncov/cases-updates/testing-in-us.html'
cdc_testing_web <- read_html(url_cdc_testing_data)
# functions to process data
endnote <- function(x) {
return(str_detect(x,'\\d$',negate=T))
}
get_last <- function(x) {
return(substr(x, nchar(x), nchar(x)))
}
cutnote <- function(x) {
return(substr(x, 1, nchar(x)-1))
}
# get data from web page
cdc_test_data <- html_nodes(cdc_testing_web, 'table') %>%
html_nodes('td') %>%
html_text() %>%
matrix(ncol=3, byrow=T, dimnames=list(NULL,c('date','CDC_labs','public_health_labs'))) %>%
as_tibble() %>%
pivot_longer(cols=c(CDC_labs, public_health_labs), names_to='lab_type',
values_to = 'tests') %>%
mutate(date = mdy(paste0(date,'/2020')),
note = ifelse(endnote(tests),get_last(tests),''),
tests = as.integer(ifelse(endnote(tests),cutnote(tests),tests)))
# graph data
# get last date with complete data
full_data_date <- cdc_test_data %>%
filter(lab_type=='public_health_labs', nchar(note) == 0) %>%
summarise(max_date = max(date)) %>%
pull(max_date)
# draw line chart
cdc_test_data %>%
filter(date <= full_data_date) %>%
group_by(date) %>%
summarise(tests=sum(tests)) %>%
ggplot(aes(x=date, y=tests, group=1)) +
geom_line() +
scale_x_date() +
scale_y_continuous(labels=scales::comma) +
labs(title='Covid-19 testing in the United States',
x='',
y='Number of tests reported',
caption= 'Source:CDC\nNote: Data for last 7 days not shown because CDC says it\'s incomplete.\nThe periodic drops occur on weekends.')
