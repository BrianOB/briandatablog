state_areas <- left_join(state_names, state_areas, by=c('state'='geography'))
churches_per_state <- left_join(state_areas,churches_per_state, by=c('abbreviation'='STATE_ALPHA'))
churches_per_state <- national_names %>%
filter(FEATURE_CLASS=='Church') %>%
group_by(STATE_ALPHA) %>%
summarise(Number = n())
state_areas <- read_csv(paste0(path_processed,'state_areas.csv'),
col_types = cols(.default=col_double(),
geography = col_character(),
internal_point_latitude_value = col_character(),
internal_point_longitude_value= col_character()))
# fix difference in how Virgin Islands is named in the two files
state_areas <- state_areas %>%
mutate(geography = ifelse(geography=='U.S. Virgin Islands','Virgin Islands',geography))
state_areas <- left_join(state_names, state_areas, by=c('state'='geography'))
churches_per_state <- left_join(state_areas,churches_per_state, by=c('abbreviation'='STATE_ALPHA'))
state_areas <- left_join(state_names, state_areas, by=c('state'='geography'))
churches_per_state <- national_names %>%
filter(FEATURE_CLASS=='Church') %>%
group_by(STATE_ALPHA) %>%
summarise(Number = n())
state_areas <- read_csv(paste0(path_processed,'state_areas.csv'),
col_types = cols(.default=col_double(),
geography = col_character(),
internal_point_latitude_value = col_character(),
internal_point_longitude_value= col_character()))
# fix difference in how Virgin Islands is named in the two files
state_areas <- state_areas %>%
mutate(geography = ifelse(geography=='U.S. Virgin Islands','Virgin Islands',geography))
state_areas <- left_join(state_names, state_areas, by=c('state'='geography'))
churches_per_state <- left_join(state_areas,churches_per_state, by=c('abbreviation'='STATE_ALPHA')) %>%
select(state, total_sq_mi, Number) %>%
mutate(churches_sq_mi = round(Number / total_sq_mi, digits=1))
churches_per_state <- national_names %>%
filter(FEATURE_CLASS=='Church') %>%
group_by(STATE_ALPHA) %>%
summarise(Number = n())
state_areas <- read_csv(paste0(path_processed,'state_areas.csv'),
col_types = cols(.default=col_double(),
geography = col_character(),
internal_point_latitude_value = col_character(),
internal_point_longitude_value= col_character()))
# fix difference in how Virgin Islands is named in the two files
state_areas <- state_areas %>%
mutate(geography = ifelse(geography=='U.S. Virgin Islands','Virgin Islands',geography))
state_areas <- left_join(state_names, state_areas, by=c('state'='geography'))
churches_per_state <- left_join(state_areas,churches_per_state, by=c('abbreviation'='STATE_ALPHA')) %>%
select(state, total_sq_mi, Number) %>%
mutate(churches_10sq_mi = round(Number / (total_sq_mi/10), digits=1))
churches_per_state <- national_names %>%
filter(FEATURE_CLASS=='Church') %>%
group_by(STATE_ALPHA) %>%
summarise(Number = n())
state_areas <- read_csv(paste0(path_processed,'state_areas.csv'),
col_types = cols(.default=col_double(),
geography = col_character(),
internal_point_latitude_value = col_character(),
internal_point_longitude_value= col_character()))
# fix difference in how Virgin Islands is named in the two files
state_areas <- state_areas %>%
mutate(geography = ifelse(geography=='U.S. Virgin Islands','Virgin Islands',geography))
state_areas <- left_join(state_names, state_areas, by=c('state'='geography'))
churches_per_state <- left_join(state_areas,churches_per_state, by=c('abbreviation'='STATE_ALPHA')) %>%
select(state, total_sq_mi, Number) %>%
mutate(churches_10sq_mi = round(Number / (total_sq_mi/10), digits=3))
blogdown:::serve_site()
blogdown:::new_post_addin()
View(churches_per_state)
library(tidyverse)
library(DT)
path_data_census <- 'C:/Users/bowli/Documents/data/Census/geo_files/'
path_common <- 'C:/Users/bowli/Documents/data/commonly_used/'
national_names <- read_delim(paste0(path_data_census,'NationalFile/NationalFile_20191101.txt'),
delim='|',
col_types = cols(.default=col_character(),
ELEV_IN_M = col_double(),
ELEV_IN_FT = col_double()),
quote = "")
# state names
state_names <- read_tsv(paste0(path_common,'state_abbreviations.csv'))
# state areas
state_areas <- read_csv(paste0(path_processed,'state_areas.csv'),
col_types = cols(.default=col_double(),
geography = col_character(),
internal_point_latitude_value = col_character(),
internal_point_longitude_value= col_character()))
library(tidyverse)
library(DT)
path_data_census <- 'C:/Users/bowli/Documents/data/Census/geo_files/'
path_common <- 'C:/Users/bowli/Documents/data/commonly_used/'
national_names <- read_delim(paste0(path_data_census,'NationalFile/NationalFile_20191101.txt'),
delim='|',
col_types = cols(.default=col_character(),
ELEV_IN_M = col_double(),
ELEV_IN_FT = col_double()),
quote = "")
# state names
state_names <- read_tsv(paste0(path_common,'state_abbreviations.csv'))
# state areas
state_areas <- read_csv(paste0(path_common,'state_areas.csv'),
col_types = cols(.default=col_double(),
geography = col_character(),
internal_point_latitude_value = col_character(),
internal_point_longitude_value= col_character()))
state_areas <- state_areas %>%
mutate(geography = ifelse(geography=='U.S. Virgin Islands','Virgin Islands',geography))
state_areas <- left_join(state_names, state_areas, by=c('state'='geography'))
class_count <- national_names %>%
group_by(FEATURE_CLASS) %>%
summarise(Number = n()) %>%
arrange(desc(Number)) %>%
select(Class = FEATURE_CLASS, Number)
View(class_count)
class_count %>%
datatable()
class_count %>%
datatable() %>%
formatCurrency('Number',currency='')
class_count %>%
datatable() %>%
formatCurrency('Number',currency='',digits=0)
church_pct <- class_count$Number[class_count$Class=='Church'] / sum(class_count$Number)
church_names <- national_names %>%
filter(FEATURE_CLASS == 'Church') %>%
group_by(FEATURE_NAME) %>%
summarise(Number = n()) %>%
top_n(50,wt=Number) %>%
arrange(desc(Number)) %>%
select(Name = FEATURE_NAME, Number)
View(church_names)
church_names_unique <- nrow(national_names %>%
filter(FEATURE_CLASS=='Church') %>%
distinct(FEATURE_NAME))
church_number = nrow(national_names %>%
filter(FEATURE_CLASS=='Church'))
church_names_unique <- nrow(national_names %>%
filter(FEATURE_CLASS == 'Church') %>%
group_by(FEATURE_NAME) %>%
count() %>%
filter(n==1))
church_names_count <- nrow(national_names %>%
filter(FEATURE_CLASS == 'Church') %>%
distinct(FEATURE_NAME))
church_names_unique / church_names_count
church_names2 <- national_names %>%
filter(FEATURE_CLASS=='Church') %>%
group_by(FEATURE_NAME) %>%
summarise(Number= n())
church_names2 %>%
filter(str_detect(FEATURE_NAME,'First Baptist'))
church_names2 <- national_names %>%
filter(FEATURE_CLASS=='Church') %>%
group_by(FEATURE_NAME) %>%
summarise(Number= n())
church_names2 %>%
filter(str_detect(FEATURE_NAME,'First Baptist')) %>%
summarise(sum(Number))
class_count %>%
datatable() %>%
formatCurrency('Number',currency='',digits=0)
churches_per_state <- national_names %>%
filter(FEATURE_CLASS=='Church') %>%
group_by(STATE_ALPHA) %>%
summarise(Number = n())
churches_per_state <- left_join(state_areas,churches_per_state, by=c('abbreviation'='STATE_ALPHA')) %>%
select(state, total_sq_mi, Number) %>%
mutate(churches_10sq_mi = round(Number / (total_sq_mi/10), digits=3))
library(choroplethr)
View(churches_per_state)
help("state_choropleth")
df_pop_state
help('choroplethr')
head(df_pop_state)
test <- def_pop_state
data(df_pop_state)
df_pop_state
churches_per_state %>%
select(region=tolower(state),value=churches_10sq_mi) %>%
state_choropleth(num_colors=5)
churches_per_state %>%
select(region=state,value=churches_10sq_mi) %>%
mutate(region = tolower(region)) %>%
state_choropleth(num_colors=5)
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state %>%
select(region=state,value=churches_10sq_mi) %>%
filter(! region %in% unmappable) %>%
mutate(region = tolower(region)) %>%
state_choropleth(num_colors=5)
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state %>%
select(region=state,value=churches_10sq_mi) %>%
mutate(region = tolower(region)) %>%
filter(! region %in% unmappable) %>%
state_choropleth(num_colors=5)
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state %>%
select(region=state,value=churches_10sq_mi) %>%
mutate(region = tolower(region)) %>%
filter(! region %in% unmappable) %>%
state_choropleth(num_colors=5,
title='Churches per 10 square miles',
legend='Density')
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state %>%
select(region=state,value=churches_10sq_mi) %>%
mutate(region = tolower(region)) %>%
filter(! region %in% unmappable) %>%
state_choropleth(num_colors=7,
title='Churches per 10 square miles',
legend='Density')
unmappable = c('guam','puerto rico','virgin islands','district of columbia')
churches_per_state %>%
select(region=state,value=churches_10sq_mi) %>%
mutate(region = tolower(region)) %>%
filter(! region %in% unmappable) %>%
state_choropleth(num_colors=7,
title='Churches per 10 square miles',
legend='Density')
unmappable = c('guam','puerto rico','virgin islands','district of columbia')
churches_per_state %>%
select(region=state,value=churches_10sq_mi) %>%
mutate(region = tolower(region)) %>%
filter(! region %in% unmappable) %>%
state_choropleth(num_colors=1,
title='Churches per 10 square miles',
legend='Density')
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state %>%
select(region=state,value=churches_10sq_mi) %>%
mutate(region = tolower(region)) %>%
filter(! region %in% unmappable) %>%
state_choropleth(num_colors=1,
title='Churches per 10 square miles',
legend='Density')
library(BAMMtools) # jenks
jenkies <- getJenksBreaks(churches_per_state$churches_10sq_mi, k=5)
churches_per_state %>%
mutate(category = cut(churches_10sq_mi,jenkies,labels=c('a','b','c','d','e')))
jenkies <- getJenksBreaks(churches_per_state$churches_10sq_mi, k=6)
jenkies <- getJenksBreaks(churches_per_state$churches_10sq_mi, k=6)
churches_per_state %>%
mutate(category = cut(churches_10sq_mi,jenkies,labels=c('a','b','c','d','e')))
jenkies <- getJenksBreaks(churches_per_state$churches_10sq_mi, k=6)
churches_per_state %>%
mutate(category = cut(churches_10sq_mi,jenkies,labels=c('a','b','c','d','e'),include.lowest = T))
jenkies <- getJenksBreaks(churches_per_state$churches_10sq_mi, k=6)
churches_per_state %>%
mutate(category = cut(churches_10sq_mi,jenkies,labels=c('a','b','c','d','e'),include.lowest = T)) %>%
group_by(category) %>%
count()
jenkies
jenkies <- getJenksBreaks(churches_per_state$churches_10sq_mi[churches_per_state$churches_10sq_mi<10], k=6)
churches_per_state %>%
mutate(category = cut(churches_10sq_mi,jenkies,labels=c('a','b','c','d','e'),include.lowest = T)) %>%
group_by(category) %>%
count()
jenkies <- getJenksBreaks(churches_per_state$churches_10sq_mi[churches_per_state$churches_10sq_mi<10], k=6)
jenkies[6] = 101.029
churches_per_state %>%
mutate(category = cut(churches_10sq_mi,jenkies,labels=c('a','b','c','d','e'),include.lowest = T)) %>%
group_by(category) %>%
count()
jenkies
jenkies <- getJenksBreaks(churches_per_state$churches_10sq_mi[churches_per_state$churches_10sq_mi<10], k=6)
jenkies[6] = 101.029
jenkies2 = c(0, .5, 1.25, 2, 3, 102)
churches_per_state %>%
mutate(category = cut(churches_10sq_mi,jenkies2,labels=c('a','b','c','d','e'),include.lowest = T)) %>%
group_by(category) %>%
count()
jenkies <- getJenksBreaks(churches_per_state$churches_10sq_mi[churches_per_state$churches_10sq_mi<10], k=6)
jenkies[6] = 101.029
jenkies2 = c(0, .5, 1.5, 2, 3, 102)
churches_per_state %>%
mutate(category = cut(churches_10sq_mi,jenkies2,labels=c('a','b','c','d','e'),include.lowest = T)) %>%
group_by(category) %>%
count()
jenkies <- getJenksBreaks(churches_per_state$churches_10sq_mi[churches_per_state$churches_10sq_mi<10], k=6)
jenkies[6] = 101.029
jenkies2 = c(0, .5, 1, 2, 3, 102)
churches_per_state %>%
mutate(category = cut(churches_10sq_mi,jenkies2,labels=c('a','b','c','d','e'),include.lowest = T)) %>%
group_by(category) %>%
count()
jenkies <- getJenksBreaks(churches_per_state$churches_10sq_mi[churches_per_state$churches_10sq_mi<10], k=6)
jenkies[6] = 101.029
jenkies2 = c(0, .5, 1, 2, 3, 102)
churches_per_state %>%
mutate(category = cut(churches_10sq_mi,jenkies2,labels=c('.5 or less','.51 to 1','1.1 to 2','2.1 to 3','more than 3'),include.lowest = T)) %>%
group_by(category) %>%
count()
library(usmap)
install.packages('usmap')
library(usmap)
R.version()
R.version
plot_usmap(regions='states',data=churches_per_state,values='churches_10sq_mi')
plot_usmap(regions='states',data=churches_per_state,values='churches_10sq_mi') +
scale_fill_discrete(breaks=c(0,.5,1,2,3,102),labels=c('.5 or less','.51 to 1','1.1 to 2','2.1 to 3','more than 3'))
plot_usmap(regions='states',data=churches_per_state,values='churches_10sq_mi') +
scale_fill_discrete(breaks=c(.5,1,2,3,102),labels=c('.5 or less','.51 to 1','1.1 to 2','2.1 to 3','more than 3'))
plot_usmap(regions='states',data=churches_per_state,values='churches_10sq_mi') +
scale_fill_continuous(breaks=c(.5,1,2,3,102),labels=c('.5 or less','.51 to 1','1.1 to 2','2.1 to 3','more than 3'))
plot_usmap(regions='states',data=churches_per_state,values='category')
churches_per_state %>%
mutate(category = cut(churches_10sq_mi,jenkies2,labels=c('.5 or less','.51 to 1','1.1 to 2','2.1 to 3','more than 3'),include.lowest = T))
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
jenkies2,
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category')
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Churches per 10 square miles by state")
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Churches per 10 square miles by state") +
theme(legend.position = 'right')
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
jenkies2,
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Churches per 10 square miles by state") +
theme(legend.position = 'right') +
scale_fill_discrete(name='Density')
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
jenkies2,
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Church Concentrations by state") +
theme(legend.position = 'right',
plot.title=element_text(hjust=.5)) +
scale_fill_discrete(name='Density')
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
jenkies2,
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Church Concentrations by state") +
theme(legend.position = 'right',
plot.title=element_text(hjust=.5, size=24)) +
scale_fill_discrete(name='Density')
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
jenkies2,
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Church Concentrations by state") +
theme(legend.position = 'right',
plot.title=element_text(hjust=.5, size=24)) +
scale_fill_discrete(name='Churches per 10 square miles')
colors()
palette()
rgb()
heat.colors()
heat.colors(5)
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
jenkies2,
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Church Concentrations by state") +
theme(legend.position = 'right',
plot.title=element_text(hjust=.5, size=24)) +
scale_fill_discrete(name='Churches per 10 square miles',
palette(heat.colors(5)))
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
jenkies2,
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Church Concentrations by state") +
theme(legend.position = 'right',
plot.title=element_text(hjust=.5, size=24)) +
scale_fill_discrete(name='Churches per 10 square miles')
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
jenkies2,
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Church Concentrations by state") +
theme(legend.position = 'right',
plot.title=element_text(hjust=.5, size=24)) +
scale_fill_discrete(name='Churches per 10 square miles',
palette('viridis'))
library(viridis)
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
jenkies2,
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Church Concentrations by state") +
theme(legend.position = 'right',
plot.title=element_text(hjust=.5, size=24)) +
scale_fill_discrete(name='Churches per 10 square miles',
palette('viridis'))
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
jenkies2,
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Church Concentrations by state") +
theme(legend.position = 'right',
plot.title=element_text(hjust=.5, size=24)) +
scale_fill_viridis(name='Churches per 10 square miles')
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
jenkies2,
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Church Concentrations by state") +
theme(legend.position = 'right',
plot.title=element_text(hjust=.5, size=24)) +
scale_fill_viridis(name='Churches per 10 square miles',discrete=T)
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
jenkies2,
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Church Concentrations by state") +
theme(legend.position = 'right',
plot.title=element_text(hjust=.5, size=24)) +
scale_fill_viridis(name='Churches per 10 square miles',discrete=T,direction=-1)
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
breaks=c(.5, 1, 2, 3, 102),
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
unmappable = c('guam','puerto rico','virgin islands')
churches_per_state <- churches_per_state %>%
mutate(category = cut(
churches_10sq_mi,
breaks=c(0,.5, 1, 2, 3, 102),
labels = c('.5 or less', '.51 to 1', '1.1 to 2', '2.1 to 3', 'more than 3'),
include.lowest = T
))
plot_usmap(regions='states',data=churches_per_state,values='category') +
labs(title = "Church Concentrations by state") +
theme(legend.position = 'right',
plot.title=element_text(hjust=.5, size=24)) +
scale_fill_viridis(name='Churches per 10 square miles',discrete=T,direction=-1)
pa_density <- churches_per_state$churches_10sq_mi[churches_per_state$state="pennsylvania"]
pa_density <- churches_per_state$churches_10sq_mi[churches_per_state$state=="pennsylvania"]
pa_density <- churches_per_state$churches_10sq_mi[churches_per_state$state=="Pennsylvania"]
wv_density <- churches_per_state$churches_10sq_mi[churches_per_state$state=="West Virginia"]
pa_density <- round(churches_per_state$churches_10sq_mi[churches_per_state$state=="Pennsylvania"],digits=1)
wv_density <- round(churches_per_state$churches_10sq_mi[churches_per_state$state=="West Virginia"],digits=1)
churches_per_state %>%
select(State = state, Density = churches_10sq_mi) %>%
datatable()
churches_per_state %>%
mutate(churches_10sq_mi = round(churches_10sq_mi,digits=1)) %>%
select(State = state, Density = churches_10sq_mi) %>%
datatable()
churches_per_state %>%
mutate(churches_10sq_mi = round(churches_10sq_mi,digits=1)) %>%
select(State = state, Churches=Number, Density = churches_10sq_mi) %>%
datatable() %>%
formatCurrency('Churches',currency='',digits=0)
46054 / 24230
blogdown:::serve_site()
