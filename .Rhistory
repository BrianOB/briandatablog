library(lubridate)
library(janitor)
library(DT)
url_page <- 'https://inciweb.nwcg.gov/accessible-view/'
urls <- read_html(url_page)
fires <- bind_cols(html_table(urls)[[1]], url =urls %>% html_nodes(xpath='//td[@headers="incident"]') %>%
html_nodes('a') %>%
html_attr('href')) %>%
mutate(url = paste0('https://inciweb.nwcg.gov',url)) %>%
clean_names()
get_details <- function(fire_name, fire_url) {
print(c(fire_name, fire_url))
details = tibble()
try({
incident_page <- read_html(fire_url)
details <- incident_page %>%
html_table() %>%
bind_rows() %>%
rename(category=X1, value=X2) %>%
mutate(name = fire_name)
})
if (nrow(details)==0) {
details = tibble(category="read error",value="not found",name=fire_name)
}
return(details)
}
detials <- bind_rows(map2(fires$incident, fires$url, get_details))
details <- detials
rm(detials)
fires_wide <- fires
fires_narrow <- fires_wide %>%
pivot_longer(cols=type:url, names_to='category', values_to='value')
rm(fires)
fires_wide %>%
datatable()
fires_narrow %>%
datatable()
fires_wide <- bind_cols(html_table(urls)[[1]], url =urls %>% html_nodes(xpath='//td[@headers="incident"]') %>%
html_nodes('a') %>%
html_attr('href')) %>%
mutate(url = paste0('https://inciweb.nwcg.gov',url)) %>%
clean_names()
get_details <- function(fire_name, fire_url) {
print(c(fire_name, fire_url))
details = tibble()
try({
incident_page <- read_html(fire_url)
details <- incident_page %>%
html_table() %>%
bind_rows() %>%
rename(category=X1, value=X2) %>%
mutate(name = fire_name)
})
if (nrow(details)==0) {
details = tibble(category="read error",value="not found",name=fire_name)
}
return(details)
}
details_narrow <- bind_rows(map2(fires$incident, fires$url, get_details))
details_narrow <- bind_rows(map2(fires_wide$incident, fires_wide$url, get_details))
fires_wide %>%
datatable()
details_narrow %>%
datatable()
View(details_narrow)
details_narrow <- details_narrow %>%
rename(incident = name) %>%
select(incident, category, value)
details_narrow %>%
datatable()
fires_narrow <- fires_wide %>%
pivot_longer(cols=type:url, names_to='category', values_to='value')
View(fires_narrow)
fires_narrow <- fires_wide %>%
pivot_longer(cols=type:url, names_to='category', values_to='value')
fire_info <- bind_rows(fires_narrow, details_narrow)
fires_info %>%
datatable()
fires_narrow <- fires_wide %>%
pivot_longer(cols=type:url, names_to='category', values_to='value')
fires_info <- bind_rows(fires_narrow, details_narrow)
fires_info %>%
datatable()
fires_info %>%
datatable()
fires_info %>%
group_by(category) %>%
count() %>%
arrange(desc(n))
fires_info %>%
group_by(category) %>%
summarise(number_of_records = count()) %>%
arrange(desc(number_of_records))
fires_info %>%
group_by(category) %>%
summarise(number_of_records = n()) %>%
arrange(desc(number_of_records))
fires_info %>%
group_by(category) %>%
summarise(number_of_records = n(),.groups='keep') %>%
arrange(desc(number_of_records))
fires_info
fires_info %>%
filter(category=="Coordinates")
details_wide <- details_narrow %>%
pivot_wider(id_cols=incident, names_from=category, values_from=value)
View(details_wide)
details_wide <- details_narrow %>%
pivot_wider(id_cols=incident, names_from=category, values_from=value)
details_wide %>%
datatable()
details_wide <- details_narrow %>%
pivot_wider(id_cols=incident, names_from=category, values_from=value) %>%
clean_names()
details_wide %>%
datatable()
details_wide <- details_narrow %>%
pivot_wider(id_cols=incident, names_from=category, values_from=value) %>%
clean_names()
details_wide %>%
datatable()
details_wide <- details_narrow %>%
pivot_wider(id_cols=incident, names_from=category, values_from=value) %>%
clean_names()
details_wide
library(pander)
details_wide <- details_narrow %>%
pivot_wider(id_cols=incident, names_from=category, values_from=value) %>%
clean_names()
details_wide %>%
pander()
details_wide %>%
kable()
library(knitr)
library(kableExtra)
details_wide %>%
kable()
details_wide %>%
kable('html') %>%
kable_styling() %>%
scroll_box(width="100%")
details_wide <- details_narrow %>%
pivot_wider(id_cols=incident, names_from=category, values_from=value) %>%
clean_names()
details_wide %>%
kable('html') %>%
kable_styling() %>%
scroll_box(width="100%")
blogdown:::serve_site()
details_wide <- details_narrow %>%
pivot_wider(id_cols=incident, names_from=category, values_from=value) %>%
clean_names()
details_wide
details_wide <- details_narrow %>%
pivot_wider(id_cols=incident, names_from=category, values_from=value) %>%
clean_names()
paged_table(details_wide)
library(rmarkdown)
details_wide <- details_narrow %>%
pivot_wider(id_cols=incident, names_from=category, values_from=value) %>%
clean_names()
paged_table(details_wide)
details_wide %>%
mutate(latitude = str_extract(coordinates,pattern='$\\d+\\.\\d+'))
details_wide %>%
mutate(latitude = str_extract(coordinates,pattern='\\d+\\.\\d+'))
details_wide %>%
mutate(latitude = str_extract(coordinates,pattern='\\d+\\.\\d+'),
longitude = str_extract(coordinates,pattern='-\\d+\\.\\d+')) %>%
select(coordinates,latitude, longitude)
details <- details_wide %>%
mutate(latitude = str_extract(coordinates,pattern='\\d+\\.\\d+'),
longitude = str_extract(coordinates,pattern='-\\d+\\.\\d+'))
details_wide <- details_wide %>%
mutate(latitude = str_extract(coordinates,pattern='\\d+\\.\\d+'),
longitude = str_extract(coordinates,pattern='-\\d+\\.\\d+'))
detais_wide %>%
mutate(current_as_of = str_extract(current_as_of,pattern='\\".*?\\"')) %>%
select(current_as_of)
details_wide %>%
mutate(current_as_of = str_extract(current_as_of,pattern='\\".*?\\"')) %>%
select(current_as_of)
details_wide %>%
mutate(current_as_of = as.Date(str_extract(current_as_of,pattern='\\".*?\\"'),format="%Y-%m-%dT%H:%M:%S")) %>%
select(current_as_of)
details_wide %>%
mutate(current_as_of = ymd_hms(str_extract(current_as_of,pattern='\\".*?\\"'))) %>%
select(current_as_of)
View(details_wide)
details_wide %>%
mutate(current_as_of = as_datetime(str_extract(current_as_of,pattern='\\".*?\\"'))) %>%
select(current_as_of)
details_wide %>%
mutate(current_as_of = as_datetime(str_extract(current_as_of,pattern='\\".*?\\"'),tz='America/Los Angeles')) %>%
select(current_as_of)
details_wide %>%
mutate(current_as_of = as_datetime(str_extract(current_as_of,pattern='\\".*?\\"'),tz='America/Los_Angeles')) %>%
select(current_as_of)
details_wide %>%
mutate(current_as_of = as_datetime(str_extract(current_as_of,pattern='\\".*?\\"'),tz='America/Denver')) %>%
select(current_as_of)
details_wide %>%
mutate(current_as_of = as_datetime(str_extract(current_as_of,pattern='\\".*?\\"'))) %>%
select(current_as_of)
details_wide <- details_wide %>%
mutate(current_as_of = as_datetime(str_extract(current_as_of,pattern='\\".*?\\"')))
details_wide <- details_narrow %>%
pivot_wider(id_cols=incident, names_from=category, values_from=value) %>%
clean_names()
paged_table(details_wide)
details_wide <- details_wide %>%
mutate(latitude = str_extract(coordinates,pattern='\\d+\\.\\d+'),
longitude = str_extract(coordinates,pattern='-\\d+\\.\\d+'))
details_wide <- details_wide %>%
mutate(current_as_of = as_datetime(str_extract(current_as_of,pattern='\\".*?\\"')))
View(details_wide)
details_narrow <- details_wide %>%
pivot_longer(cols=current_as_of:longitude, names_to='category', values_to='value')
details_wide %>%
pivot_longer(cols=current_as_of:longitude, names_to='category', values_to='value')
details_wide <- details_narrow %>%
pivot_wider(id_cols=incident, names_from=category, values_from=value) %>%
clean_names()
paged_table(details_wide)
details_wide <- details_wide %>%
mutate(latitude = str_extract(coordinates,pattern='\\d+\\.\\d+'),
longitude = str_extract(coordinates,pattern='-\\d+\\.\\d+'))
details_wide <- details_wide %>%
mutate(current_as_of = str_extract(current_as_of,pattern='\\".*?\\"'))
details_wide %>%
pivot_longer(cols=current_as_of:longitude, names_to='category', values_to='value')
details_narrow <- details_wide %>%
pivot_longer(cols=current_as_of:longitude, names_to='category', values_to='value')
fire_info_narrow <- bind_rows(fires_narrow, details_narrow)
fire_info_narrow <- bind_rows(fires_narrow, details_narrow)
fire_info_wide <- bind_cols(fires_wide, details_wide)
View(fires_wide)
View(fire_info_wide)
fire_info_wide <- bind_cols(fires_wide, details_wide,.id='incident')
View(fire_info_wide)
fire_info_narrow <- bind_rows(fires_narrow, details_narrow)
fire_info_wide <- merge(fires_wide, details_wide,by='incident')
View(fire_info_wide)
View(fires_wide)
details_narrow <- details_wide %>%
pivot_longer(cols=current_as_of:longitude, names_to='category', values_to='value')
fires_narrow <- fires_wide %>%
pivot_longer(cols=type:url, names_to='category',values_to='value')
fire_info_narrow <- bind_rows(fires_narrow, details_narrow)
fire_info_wide <- merge(fires_wide, details_wide,by='incident')
paged_table(fire_info_wide)
# libraries, and what I use them for
# general data wrangling
library(tidyverse)
# scraping
library(rvest)
# date wrangling
library(lubridate)
# data cleaning
library(janitor)
# presenting the data in tables
library(DT)
library(rmarkdown)
# read the main page to get the urls
url_page <- 'https://inciweb.nwcg.gov/accessible-view/'
urls <- read_html(url_page)
# put the info into a tibble
fires_wide <- bind_cols(html_table(urls)[[1]], url =urls %>% html_nodes(xpath='//td[@headers="incident"]') %>%
html_nodes('a') %>%
html_attr('href')) %>%
mutate(url = paste0('https://inciweb.nwcg.gov',url)) %>%
clean_names()
# function to scrape each incident page
get_details <- function(fire_name, fire_url) {
print(c(fire_name, fire_url))
details = tibble()
try({
incident_page <- read_html(fire_url)
details <- incident_page %>%
html_table() %>%
bind_rows() %>%
rename(category=X1, value=X2) %>%
mutate(name = fire_name)
})
if (nrow(details)==0) {
details = tibble(category="read error",value="not found",name=fire_name)
}
return(details)
}
# read each of the incident pages and put their info into a single tibble
details_narrow <- bind_rows(map2(fires_wide$incident, fires_wide$url, get_details))
# do a little renaming and rearranging to make it match the fires table terminology
details_narrow <- details_narrow %>%
rename(incident = name) %>%
select(incident, category, value)
fires_wide %>%
datatable()
details_narrow %>%
datatable()
paged_table(fires_wide)
paged_table(details_narrow)
details_wide <- details_narrow %>%
pivot_wider(id_cols=incident, names_from=category, values_from=value) %>%
clean_names()
paged_table(details_wide)
details_wide <- details_wide %>%
mutate(latitude = str_extract(coordinates,pattern='\\d+\\.\\d+'),
longitude = str_extract(coordinates,pattern='-\\d+\\.\\d+'))
details_wide <- details_wide %>%
mutate(current_as_of = str_extract(current_as_of,pattern='\\".*?\\"'))
details_wide %>%
rename(current_size = size)
details_wide <- details_wide %>%
rename(current_size = size)
details_narrow <- details_wide %>%
pivot_longer(cols=current_as_of:longitude, names_to='category', values_to='value')
fires_narrow <- fires_wide %>%
pivot_longer(cols=type:url, names_to='category',values_to='value')
fire_info_narrow <- bind_rows(fires_narrow, details_narrow)
fire_info_wide <- merge(fires_wide, details_wide,by='incident')
paged_table(fire_info_wide)
fire_info_narrow %>%
group_by(location) %>%
summarise(total_acreage = sum(size))
View(fire_info_narrow)
fire_info_narrow %>%
group_by(state) %>%
summarise(total_acreage = sum(size))
fire_info_wide %>%
group_by(state) %>%
summarise(total_acreage = sum(size))
View(fire_info_wide)
# libraries, and what I use them for
# general data wrangling
library(tidyverse)
# scraping
library(rvest)
# date wrangling
library(lubridate)
# data cleaning
library(janitor)
# presenting the data in tables
library(DT)
library(rmarkdown)
# read the main page to get the urls
url_page <- 'https://inciweb.nwcg.gov/accessible-view/'
urls <- read_html(url_page)
# put the info into a tibble
fires_wide <- bind_cols(html_table(urls)[[1]], url =urls %>% html_nodes(xpath='//td[@headers="incident"]') %>%
html_nodes('a') %>%
html_attr('href')) %>%
mutate(url = paste0('https://inciweb.nwcg.gov',url)) %>%
clean_names()
# function to scrape each incident page
get_details <- function(fire_name, fire_url) {
print(c(fire_name, fire_url))
details = tibble()
try({
incident_page <- read_html(fire_url)
details <- incident_page %>%
html_table() %>%
bind_rows() %>%
rename(category=X1, value=X2) %>%
mutate(name = fire_name)
})
if (nrow(details)==0) {
details = tibble(category="read error",value="not found",name=fire_name)
}
return(details)
}
# read each of the incident pages and put their info into a single tibble
details_narrow <- bind_rows(map2(fires_wide$incident, fires_wide$url, get_details))
# do a little renaming and rearranging to make it match the fires table terminology
details_narrow <- details_narrow %>%
rename(incident = name) %>%
select(incident, category, value)
paged_table(fires_wide)
fires_wide %>%
mutate(size = str_extract(size, '\\d+'))
fires_wide <- fires_wide %>%
mutate(size = str_extract(size, '\\d+')) %>%
rename(acreage=size)
paged_table(fires_wide)
details_wide <- details_narrow %>%
pivot_wider(id_cols=incident, names_from=category, values_from=value) %>%
clean_names()
paged_table(details_wide)
details_wide <- details_wide %>%
mutate(latitude = str_extract(coordinates,pattern='\\d+\\.\\d+'),
longitude = str_extract(coordinates,pattern='-\\d+\\.\\d+'))
details_wide <- details_wide %>%
mutate(current_as_of = str_extract(current_as_of,pattern='\\".*?\\"'))
View(details_wide)
details_narrow <- details_wide %>%
pivot_longer(cols=current_as_of:longitude, names_to='category', values_to='value')
fires_narrow <- fires_wide %>%
pivot_longer(cols=type:url, names_to='category',values_to='value')
fire_info_narrow <- bind_rows(fires_narrow, details_narrow)
fire_info_wide <- merge(fires_wide, details_wide,by='incident')
paged_table(fire_info_wide)
fire_info_wide %>%
group_by(state) %>%
summarise(total_acreage = sum(acreage))
fires_wide <- fires_wide %>%
mutate(size = as.numeric(str_extract(size, '\\d+'))) %>%
rename(acreage=size)
fires_wide <- bind_cols(html_table(urls)[[1]], url =urls %>% html_nodes(xpath='//td[@headers="incident"]') %>%
html_nodes('a') %>%
html_attr('href')) %>%
mutate(url = paste0('https://inciweb.nwcg.gov',url)) %>%
clean_names()
fires_wide <- fires_wide %>%
mutate(size = as.numeric(str_extract(size, '\\d+'))) %>%
rename(acreage=size)
paged_table(fires_wide)
fire_info_narrow <- bind_rows(fires_narrow, details_narrow)
fire_info_wide <- merge(fires_wide, details_wide,by='incident')
details_narrow <- details_wide %>%
pivot_longer(cols=current_as_of:longitude, names_to='category', values_to='value')
fires_narrow <- fires_wide %>%
pivot_longer(cols=type:url, names_to='category',values_to='value')
fire_info_wide <- merge(fires_wide, details_wide,by='incident')
# libraries, and what I use them for
# general data wrangling
library(tidyverse)
# scraping
library(rvest)
# date wrangling
library(lubridate)
# data cleaning
library(janitor)
# presenting the data in tables
library(DT)
library(rmarkdown)
# read the main page to get the urls
url_page <- 'https://inciweb.nwcg.gov/accessible-view/'
urls <- read_html(url_page)
# put the info into a tibble
fires_wide <- bind_cols(html_table(urls)[[1]], url =urls %>% html_nodes(xpath='//td[@headers="incident"]') %>%
html_nodes('a') %>%
html_attr('href')) %>%
mutate(url = paste0('https://inciweb.nwcg.gov',url)) %>%
clean_names()
# function to scrape each incident page
get_details <- function(fire_name, fire_url) {
print(c(fire_name, fire_url))
details = tibble()
try({
incident_page <- read_html(fire_url)
details <- incident_page %>%
html_table() %>%
bind_rows() %>%
rename(category=X1, value=X2) %>%
mutate(name = fire_name)
})
if (nrow(details)==0) {
details = tibble(category="read error",value="not found",name=fire_name)
}
return(details)
}
# read each of the incident pages and put their info into a single tibble
details_narrow <- bind_rows(map2(fires_wide$incident, fires_wide$url, get_details))
# do a little renaming and rearranging to make it match the fires table terminology
details_narrow <- details_narrow %>%
rename(incident = name) %>%
select(incident, category, value)
paged_table(fires_wide)
paged_table(details_narrow)
fires_wide <- fires_wide %>%
mutate(size = as.numeric(str_extract(size, '\\d+'))) %>%
rename(acreage=size)
paged_table(fires_wide)
details_wide <- details_narrow %>%
pivot_wider(id_cols=incident, names_from=category, values_from=value) %>%
clean_names()
paged_table(details_wide)
details_wide <- details_wide %>%
mutate(latitude = str_extract(coordinates,pattern='\\d+\\.\\d+'),
longitude = str_extract(coordinates,pattern='-\\d+\\.\\d+'))
details_wide <- details_wide %>%
mutate(current_as_of = str_extract(current_as_of,pattern='\\".*?\\"'))
fire_info_wide <- merge(fires_wide, details_wide,by='incident')
paged_table(fire_info_wide)
fire_info_wide %>%
group_by(state) %>%
summarise(total_acreage = sum(acreage))
fire_info_wide %>%
group_by(state,.groups='keep') %>%
summarise(total_acreage = sum(acreage))
fire_info_wide %>%
group_by(state) %>%
summarise(total_acreage = sum(acreage),.groups='keep')
fire_info_wide %>%
group_by(state, type) %>%
summarise(total_acreage = sum(acreage))
fire_info_wide %>%
group_by(state, type) %>%
summarise(total_acreage = sum(acreage))
fire_info_wide %>%
group_by(state, type) %>%
summarise(total_acreage = sum(acreage))
fire_info_wide %>%
group_by(state) %>%
summarise(total_acreage = sum(acreage))
fire_info_wide %>%
group_by(state, type) %>%
summarise(total_acreage = sum(acreage)) %>%
datatable(options=list(dom='t'))
fire_info_wide %>%
group_by(state) %>%
summarise(total_acreage = sum(acreage)) %>%
datatable(options=list(dom='t'))
